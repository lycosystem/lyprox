{% extends "base.html" %}
{% load static %}
{% load mytags %}

{% block head %}
{% include 'head.html' with title="LyProX Â· Download CSV" %}
{% endblock head %}

{% block content %}

<section class="section">
    <div class="container">
        <div class="columns is-centered">
            <div class="column is-5">
                <div class="box">
                    <div class="block">
                        <p class="title">Download</p>
                        <p>
                            Download CSV tables of the patients in the cohort by 
                            the institution that extracted and provides them. 
                            These table has the same structure as the one that 
                            is necessary to upload a batch of patients, so it 
                            may also be used as a template.
                        </p>
                    </div>

                    {% for table in csvtable_list %}
                    <div class="notification">
                        <div class="media">
                            <div class="media-left">
                                <figure class="block image is-48x48 is-flex is-align-items-center">
                                    <img src="{{ table.institution.logo.url }}" alt="institution logo">
                                </figure>
                            </div>
                            <div class="media-content">
                                <div class="content">
                                    <p>
                                        <strong>{{ table.institution.shortname }}</strong> @<small>{{ table.date_created | date:"Y/m/j" }}</small>
                                        <br>
                                        Cohort of {{ table.num_patients }} patients from the {{ table.institution.name }}, exported from the database on {{ table.date_created | date:"F jS, Y" }}
                                        <br>
                                    </p>
                                </div>
                                <div class="level">
                                    <div class="level-left">
                                        <div class="level-item">
                                            <a href="{{ table.file.url }}" class="button tag is-primary">
                                                <span class="icon is-medium">
                                                    <i class="fas fa-cloud-download-alt"></i>
                                                </span>
                                                <span>Download</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="content">
            {% include_md 'patients/data_description.md' %}
        </div>
    </div>
</section>

<script>
    $("#generate").click(function() {
        $("#generate").addClass("is-loading");
    });
</script>

{% endblock content %}
