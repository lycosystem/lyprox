<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "DTD/xhtml1-strict.dtd">
<html>
  

  <head>
    
    <title>lyprox.dataexplorer.query</title>
    <meta name="generator" content="pydoctor 22.9.1"> 
        
    </meta>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1" />
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="apidocs.css" />
    <link rel="stylesheet" type="text/css" href="extra.css" />
</head>

  <body>

    

    <nav class="navbar navbar-default mainnavbar">
      
  
  <div class="container-fluid">


    <div class="navbar-header">
      
      <div class="navlinks">
        <span class="navbar-brand">
          LyProX <a href="index.html">API Documentation</a>
        </span>

        <a href="moduleIndex.html">
          Modules
        </a>

        <a href="classIndex.html">
          Classes
        </a>

        <a href="nameIndex.html">
          Names
        </a>

        <div id="search-box-container">
          <div class="input-group">
            <input id="search-box" type="search" name="search-query" placeholder="Search..." aria-label="Search" minlength="2" class="form-control" autocomplete="off" />
            
            <span class="input-group-btn">
              <a style="display: none;" class="btn btn-default" id="search-clear-button" title="Clear" onclick="clearSearch()"><img src="fonts/x-circle.svg" alt="Clear" /></a>
              <a class="btn btn-default" id="search-help-button" title="Help" onclick="toggleSearchHelpText()"><img src="fonts/info.svg" alt="Help" /></a>
            </span>
          </div>
        </div>

      </div>

      <div id="search-results-container" style="display: none;">
        
        <div id="search-buttons">
          <span class="label label-default" id="search-docstrings-button">
          <label class="checkbox-inline">
            <input type="checkbox" id="toggle-search-in-docstrings-checkbox" value="false" onclick="toggleSearchInDocstrings()">
              search in docstrings
            </input>
          </label>
          </span>
          
        </div>
        
        <noscript>
            <h1>Cannot search: JavaScript is not supported/enabled in your browser.</h1>
        </noscript>

        <div class="hint" id="search-help-box">
          <p class="rst-last">
      
            Search bar offers the following options:
            <ul>   
                <li>
                  <strong>Term presence.</strong> The below example searches for documents that 
                    must contain “foo”, might contain “bar” and must not contain “baz”: <code>+foo bar -baz</code>
                </li> 

                <li>
                  <strong>Wildcards.</strong> The below example searches for documents with words beginning with “foo”: <code>foo*</code>
                </li> 

                <li>
                  <strong>Search in specific fields.</strong> The following search matches all objects 
                  in "twisted.mail" that matches “search”: <code>+qname:twisted.mail.* +search</code>

                  <p>
                    Possible fields: 'name', 'qname' (fully qualified name), 'docstring', and 'kind'.
                    Last two fields are only applicable if "search in docstrings" is enabled.
                  </p>
                </li>

                <li>
                  <strong>Fuzzy matches.</strong> The following search matches all documents 
                  that have a word within 1 edit distance of “foo”: <code>foo~1</code>
                </li>
            </ul>

          </p>
        </div>

        <div id="search-status"> </div>

        <div class="warning" id="search-warn-box" style="display: none;">
          <p class="rst-last"><span id="search-warn"></span></p>
        </div>

        <table id="search-results">
          <!-- Filled dynamically by JS -->
        </table>
        
        <div style="margin-top: 8px;">
          <p>Results provided by <a href="https://lunrjs.com">Lunr.js</a></p>
        </div>
      </div>

    </div>


  </div>
</nav>
    
    <div class="container-fluid">

      <!-- Side navigation -->
      <div class="sidebarcontainer" style="display: none;">
        
        <div class="sidebar"><nav class="sidebar">
  

  <div>

      <div class="thingTitle">
        <span>Module</span>
        <code class="thisobject"><a href="lyprox.dataexplorer.query.html" class="internal-link" title="This module">query</a></code> 
      </div>
      
      <div>
        

        
         

        <div class="childrenKindTitle">Classes</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="lyprox.dataexplorer.query.ModalityCombinor.html" class="internal-link" title="lyprox.dataexplorer.query.ModalityCombinor"><wbr></wbr>Modality<wbr></wbr>Combinor</a></code>
            </div>
        

    </li>
</ul>

        <div class="childrenKindTitle">Functions</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="#collect_info" class="internal-link" title="lyprox.dataexplorer.query.collect_info">collect<wbr></wbr>_info</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#combine_diagnoses" class="internal-link" title="lyprox.dataexplorer.query.combine_diagnoses">combine<wbr></wbr>_diagnoses</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#compute_statistics" class="internal-link" title="lyprox.dataexplorer.query.compute_statistics">compute<wbr></wbr>_statistics</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#diagnose_specific" class="internal-link" title="lyprox.dataexplorer.query.diagnose_specific">diagnose<wbr></wbr>_specific</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#does_patient_match" class="internal-link" title="lyprox.dataexplorer.query.does_patient_match">does<wbr></wbr>_patient<wbr></wbr>_match</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#extract_filter_pattern" class="internal-link" title="lyprox.dataexplorer.query.extract_filter_pattern">extract<wbr></wbr>_filter<wbr></wbr>_pattern</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#patient_specific" class="internal-link" title="lyprox.dataexplorer.query.patient_specific">patient<wbr></wbr>_specific</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#run_query" class="internal-link" title="lyprox.dataexplorer.query.run_query">run<wbr></wbr>_query</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#sort_diagnoses_by_patient" class="internal-link" title="lyprox.dataexplorer.query.sort_diagnoses_by_patient">sort<wbr></wbr>_diagnoses<wbr></wbr>_by<wbr></wbr>_patient</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#sort_patients_by_id" class="internal-link" title="lyprox.dataexplorer.query.sort_patients_by_id">sort<wbr></wbr>_patients<wbr></wbr>_by<wbr></wbr>_id</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#sort_tumors_by_patient" class="internal-link" title="lyprox.dataexplorer.query.sort_tumors_by_patient">sort<wbr></wbr>_tumors<wbr></wbr>_by<wbr></wbr>_patient</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#subsite2arr" class="internal-link" title="lyprox.dataexplorer.query.subsite2arr">subsite2arr</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#tf2arr" class="internal-link" title="lyprox.dataexplorer.query.tf2arr">tf2arr</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#tumor_specific" class="internal-link" title="lyprox.dataexplorer.query.tumor_specific">tumor<wbr></wbr>_specific</a></code>
            </div>
        

    </li>
</ul> 

        
         

        <div class="childrenKindTitle">Variables</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="#logger" class="internal-link" title="lyprox.dataexplorer.query.logger">logger</a></code>
            </div>
        

    </li>
</ul> 

        
         
        
      </div>
  </div><div>

      <div class="thingTitle">
        <span>Package</span>
        <code><a href="lyprox.dataexplorer.html" class="internal-link" title="The parent of this module">dataexplorer</a></code> 
      </div>
      
      <div>
        

        <div class="childrenKindTitle">Modules</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="lyprox.dataexplorer.forms.html" class="internal-link" title="lyprox.dataexplorer.forms">forms</a></code>
            </div>
        

    </li><li class=" thisobject">
        
        
        

        
            <div class="itemName"><code><a href="lyprox.dataexplorer.query.html" class="internal-link" title="lyprox.dataexplorer.query">query</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="lyprox.dataexplorer.urls.html" class="internal-link" title="lyprox.dataexplorer.urls">urls</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="lyprox.dataexplorer.views.html" class="internal-link" title="lyprox.dataexplorer.views">views</a></code>
            </div>
        

    </li>
</ul> 

        
        

        
         

        
         

        
         

        
         
        
      </div>
  </div>

</nav>
        </div>
        <div id="collapseSideBar">
          <a class="btn btn-link" onclick="toggleSideBarCollapse()" title="Toggle Sidebar Collapse">
          </a>
        </div> 
        <script src="sidebartoggle.js" type="text/javascript"></script>
       
      </div>

      <div id="main" class="">
        

        

        <div class="page-header">
          <h1 class="module"><code><code><a href="index.html" class="internal-link">lyprox</a></code><wbr></wbr>.<code><a href="lyprox.dataexplorer.html" class="internal-link" title="lyprox.dataexplorer">dataexplorer</a></code><wbr></wbr>.<code><a href="lyprox.dataexplorer.query.html" class="internal-link" title="lyprox.dataexplorer.query">query</a></code></code></h1>
          <div id="showPrivate">
            <button class="btn btn-link" onclick="togglePrivate()">Toggle Private API</button>
          </div>
        </div>

        <div class="categoryHeader">
          module documentation
        </div>

        <div class="extrasDocstring">
          
          <p></p>
        </div>

        <div class="moduleDocstring">
          <div><p>Module for translating the user input into a database query. It retrieves the
information of interest and returns it in a format that can then be put into the
response of the server.</p>
<p>The main interaction point is the <code><a href="#run_query" class="internal-link" title="lyprox.dataexplorer.query.run_query">run_query</a></code> function. It takes an initial <tt class="rst-docutils literal">QuerySet</tt>
of <code><a href="lyprox.patients.models.Patient.html" class="internal-link" title="lyprox.patients.models.Patient">patients.models.Patient</a></code> objects and filters it down according to the cleaned data
from a <code>form.DashboardForm</code>.</p>
</div>
        </div>

        <div id="splitTables">
          <table class="children sortable" id="id37">
  
  
  <tr class="class">
    
    <td>Class</td>
    <td><code><a href="lyprox.dataexplorer.query.ModalityCombinor.html" class="internal-link" title="lyprox.dataexplorer.query.ModalityCombinor"><wbr></wbr>Modality<wbr></wbr>Combinor</a></code></td>
    <td>Utility class that defines and helps to select the various methods for combining diagnoses from different modalities.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#collect_info" class="internal-link" title="lyprox.dataexplorer.query.collect_info">collect<wbr></wbr>_info</a></code></td>
    <td>Collect the patient-, tumor-, and diagonse-information in one dictionary.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#combine_diagnoses" class="internal-link" title="lyprox.dataexplorer.query.combine_diagnoses">combine<wbr></wbr>_diagnoses</a></code></td>
    <td>Combine the potentially conflicting diagnoses for each patient and each side according to the chosen combination method.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#compute_statistics" class="internal-link" title="lyprox.dataexplorer.query.compute_statistics">compute<wbr></wbr>_statistics</a></code></td>
    <td>Use the collected information as returned by <code><a href="lyprox.dataexplorer.query.html#collect_info" class="internal-link" title="lyprox.dataexplorer.query.collect_info">collect_info</a></code> and generate statistics for them.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#diagnose_specific" class="internal-link" title="lyprox.dataexplorer.query.diagnose_specific">diagnose<wbr></wbr>_specific</a></code></td>
    <td>Filter the diagnoses based on selected involvement patterns.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#does_patient_match" class="internal-link" title="lyprox.dataexplorer.query.does_patient_match">does<wbr></wbr>_patient<wbr></wbr>_match</a></code></td>
    <td>Compare the diagnose of a patient with the involvement pattern to filter for.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#extract_filter_pattern" class="internal-link" title="lyprox.dataexplorer.query.extract_filter_pattern">extract<wbr></wbr>_filter<wbr></wbr>_pattern</a></code></td>
    <td>Sort the <tt class="rst-docutils literal">kwargs</tt> from the request.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#patient_specific" class="internal-link" title="lyprox.dataexplorer.query.patient_specific">patient<wbr></wbr>_specific</a></code></td>
    <td>Filter <tt class="rst-docutils literal">QuerySet</tt> of patients based on patient-specific properties.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#run_query" class="internal-link" title="lyprox.dataexplorer.query.run_query">run<wbr></wbr>_query</a></code></td>
    <td>Run a database query using the cleaned form data from the <code><a href="lyprox.dataexplorer.forms.DashboardForm.html" class="internal-link" title="lyprox.dataexplorer.forms.DashboardForm">forms.DashboardForm</a></code>.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#sort_diagnoses_by_patient" class="internal-link" title="lyprox.dataexplorer.query.sort_diagnoses_by_patient">sort<wbr></wbr>_diagnoses<wbr></wbr>_by<wbr></wbr>_patient</a></code></td>
    <td>Use a <tt class="rst-docutils literal">QuerySet</tt> of <code>patient.models.Diagnose</code> and sort its entries into a nested dictionary.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#sort_patients_by_id" class="internal-link" title="lyprox.dataexplorer.query.sort_patients_by_id">sort<wbr></wbr>_patients<wbr></wbr>_by<wbr></wbr>_id</a></code></td>
    <td>Collect patient information by patient ID in a dictionary.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#sort_tumors_by_patient" class="internal-link" title="lyprox.dataexplorer.query.sort_tumors_by_patient">sort<wbr></wbr>_tumors<wbr></wbr>_by<wbr></wbr>_patient</a></code></td>
    <td>Collect tumor information by patient ID in a dictionary.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#subsite2arr" class="internal-link" title="lyprox.dataexplorer.query.subsite2arr">subsite2arr</a></code></td>
    <td>Map different subsites to an one-hot-array of subsite groups.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#tf2arr" class="internal-link" title="lyprox.dataexplorer.query.tf2arr">tf2arr</a></code></td>
    <td>Map <tt class="rst-docutils literal">True</tt>, <tt class="rst-docutils literal">False</tt> &amp; <tt class="rst-docutils literal">None</tt> to one-hot-arrays of length 3.</td>
  </tr><tr class="function">
    
    <td>Function</td>
    <td><code><a href="#tumor_specific" class="internal-link" title="lyprox.dataexplorer.query.tumor_specific">tumor<wbr></wbr>_specific</a></code></td>
    <td>Filter <tt class="rst-docutils literal">QuerySet</tt> of tumors based on tumor-specific properties.</td>
  </tr><tr class="variable">
    
    <td>Variable</td>
    <td><code><a href="#logger" class="internal-link" title="lyprox.dataexplorer.query.logger">logger</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr>
</table>
          

            
        </div>

        <div id="childList">
          <div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.collect_info">
    
  </a>
  <a name="collect_info">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">collect_info</span>(patients, tumors, diagnoses):
    
    <a class="headerLink" href="#collect_info" title="lyprox.dataexplorer.query.collect_info">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Collect the patient-, tumor-, and diagonse-information in one dictionary.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">patients:</span><code>Dict[<wbr></wbr>int, <wbr></wbr>Any]</code></td><td class="fieldArgDesc">Patients sorted by ID. Should be the output of <code><a href="#sort_patients_by_id" class="internal-link" title="lyprox.dataexplorer.query.sort_patients_by_id">sort_patients_by_id</a></code></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">tumors:</span><code>Dict[<wbr></wbr>int, <wbr></wbr>Any]</code></td><td class="fieldArgDesc">Tumors by patient ID, as returned by <code><a href="#sort_tumors_by_patient" class="internal-link" title="lyprox.dataexplorer.query.sort_tumors_by_patient">sort_tumors_by_patient</a></code></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">diagnoses:</span><code>Dict[<wbr></wbr>int, <wbr></wbr>Any]</code></td><td class="fieldArgDesc">Combined involvement by patient ID. Output of
<code><a href="#sort_diagnoses_by_patient" class="internal-link" title="lyprox.dataexplorer.query.sort_diagnoses_by_patient">sort_diagnoses_by_patient</a></code>.</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>Dict[<wbr></wbr>int, <wbr></wbr>Any]</code></td><td class="fieldArgDesc">A dictionary with patient IDs as keys and the combined information underneath.</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.combine_diagnoses">
    
  </a>
  <a name="combine_diagnoses">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">combine_diagnoses</span>(method, diagnoses):
    
    <a class="headerLink" href="#combine_diagnoses" title="lyprox.dataexplorer.query.combine_diagnoses">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Combine the potentially conflicting diagnoses for each patient and each side
according to the chosen combination method.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">method:</span><code>Callable</code></td><td class="fieldArgDesc">The function used to combine them. It should only take a tuple of
values where each value represents the involvement for the same LNL as
reported by the different modalities. The order of the values corresponds
to the order of the modalities in <code><a href="lyprox.patients.models.Diagnose.Modalities.html" class="internal-link" title="lyprox.patients.models.Diagnose.Modalities">patients.models.Diagnose.Modalities</a></code>.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">diagnoses:</span><code>Dict[<wbr></wbr>int, <wbr></wbr>Dict[<wbr></wbr>str, <wbr></wbr>np.ndarray]]</code></td><td class="fieldArgDesc">This should be the output of the <code>sort_diagnoses</code> function.</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>Dict[<wbr></wbr>int, <wbr></wbr>Dict[<wbr></wbr>str, <wbr></wbr>Dict[<wbr></wbr>str, <wbr></wbr>Optional[<wbr></wbr>bool]]]]</code></td><td class="fieldArgDesc">A dictionary where the combined involvement per LNL is stored under the
corresponding patient ID, side (<tt class="rst-docutils literal">ipsi</tt> or <tt class="rst-docutils literal">contra</tt>) and the respective
LNL's name (e.g. <tt class="rst-docutils literal">IIa</tt>).</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.compute_statistics">
    
  </a>
  <a name="compute_statistics">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">compute_statistics</span>(patients):
    
    <a class="headerLink" href="#compute_statistics" title="lyprox.dataexplorer.query.compute_statistics">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Use the collected information as returned by <code><a href="#collect_info" class="internal-link" title="lyprox.dataexplorer.query.collect_info">collect_info</a></code> and generate
statistics for them.</p>
<p>Many of these statistics come in the form of a list of length 3. They indicate for
how many patients the correpsonding field was <tt class="rst-docutils literal">True</tt> (index <tt class="rst-docutils literal">1</tt>), <tt class="rst-docutils literal">False</tt>
(index <tt class="rst-docutils literal"><span class="pre">-1</span></tt>, meaning the last entry), or <tt class="rst-docutils literal">None</tt> (index <tt class="rst-docutils literal">0</tt>).</p>
<p>So, for example, <tt class="rst-docutils literal">"hpv_status": [23, 82, 72]</tt> means that 82 patients are HPV
positive, 72 HPV negative and for 23 we do not have any information.</p>
<p>In the beginning, this kind of encoding seemed smart, because I could give semantic
meaning to an index (positive being +1, negative -1). But in Django's HTML
templates that doesn't work and I have to use 0, 1, and 2 there...</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">patients:</span><code>Dict[<wbr></wbr>int, <wbr></wbr>Any]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>Dict[<wbr></wbr>str, <wbr></wbr>Any]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.diagnose_specific">
    
  </a>
  <a name="diagnose_specific">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">diagnose_specific</span>(diagnoses, modalities, modality_combine=<span class="rst-variable-quote">'</span><span class="rst-variable-string">maxLLH</span><span class="rst-variable-quote">'</span>, n_status=None, **kwargs):
    
    <a class="headerLink" href="#diagnose_specific" title="lyprox.dataexplorer.query.diagnose_specific">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Filter the diagnoses based on selected involvement patterns.</p>
<p>In contrast to the <code><a href="#patient_specific" class="internal-link" title="lyprox.dataexplorer.query.patient_specific">patient_specific</a></code> and <code><a href="#tumor_specific" class="internal-link" title="lyprox.dataexplorer.query.tumor_specific">tumor_specific</a></code> functions, this one is
more complicated: It needs to combine multiple modalities' information before
checking if a patient's involvement matches the selected pattern.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">diagnoses:</span><code>Optional[<wbr></wbr>QuerySet]</code></td><td class="fieldArgDesc"><tt class="rst-docutils literal">QuerySet</tt> of diagnoses. If <tt class="rst-docutils literal">None</tt>, all diagnose entries in the
database will be used.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">modalities:</span><code>Optional[<wbr></wbr>List[<wbr></wbr>int]]</code></td><td class="fieldArgDesc">List of diagnostic modalities to consider in the filtering.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">modality<wbr></wbr>_combine:</span><code>str</code></td><td class="fieldArgDesc">Name of the method to use for combining multiple, possibly
conflicting diagnoses from different modalities.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">n<wbr></wbr>_status:</span><code>Optional[<wbr></wbr>bool]</code></td><td class="fieldArgDesc">If <tt class="rst-docutils literal">True</tt>, only patients will be kept that are N+ patients.
<tt class="rst-docutils literal">False</tt> means only N0 patients are kept and <tt class="rst-docutils literal">None</tt> ignores N-status.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">**kwargs</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>Dict[<wbr></wbr>int, <wbr></wbr>Dict[<wbr></wbr>str, <wbr></wbr>Dict[<wbr></wbr>str, <wbr></wbr>Optional[<wbr></wbr>bool]]]]</code></td><td class="fieldArgDesc">A nested dictionary with patient IDs as top-level keys. Under each patient,
there are the keys <tt class="rst-docutils literal">"ipsi"</tt> and <tt class="rst-docutils literal">"contra"</tt>. And under that, finally, a
dictionary stores the combined involvement (can be <tt class="rst-docutils literal">True</tt> for metastatic,
<tt class="rst-docutils literal">False</tt> for healthy, or <tt class="rst-docutils literal">None</tt> for unknown) per LNL.</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.does_patient_match">
    
  </a>
  <a name="does_patient_match">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">does_patient_match</span>(patient_diagnose, filter_pattern, n_status):
    
    <a class="headerLink" href="#does_patient_match" title="lyprox.dataexplorer.query.does_patient_match">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Compare the diagnose of a patient with the involvement pattern to filter for.</p>
<p>A 'match' occurs, when for both sides (<tt class="rst-docutils literal">ipsi</tt> &amp; <tt class="rst-docutils literal">contra</tt>)
and all LNLs the patient's diagnose and the <tt class="rst-docutils literal">filter_pattern</tt> are the same or the
latter is undefined (<tt class="rst-docutils literal">None</tt>).</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">patient<wbr></wbr>_diagnose:</span><code>Dict[<wbr></wbr>str, <wbr></wbr>Dict[<wbr></wbr>str, <wbr></wbr>Optional[<wbr></wbr>bool]]]</code></td><td class="fieldArgDesc">The diagnose of a single patient, as they are stored by their
IDs in the output of the <code><a href="#combine_diagnoses" class="internal-link" title="lyprox.dataexplorer.query.combine_diagnoses">combine_diagnoses</a></code> dictionary.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">filter<wbr></wbr>_pattern:</span><code>Dict[<wbr></wbr>str, <wbr></wbr>Dict[<wbr></wbr>str, <wbr></wbr>Optional[<wbr></wbr>bool]]]</code></td><td class="fieldArgDesc">The involvement pattern that was selected in the <code>dashboard</code>
by the user, collected in the same format as the <tt class="rst-docutils literal">patient_diagnose</tt>.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">n<wbr></wbr>_status:</span><code>Optional[<wbr></wbr>bool]</code></td><td class="fieldArgDesc">If <tt class="rst-docutils literal">True</tt>, only patients will be kept that are N+ patients.
<tt class="rst-docutils literal">False</tt> means only N0 patients are kept and <tt class="rst-docutils literal">None</tt> ignores N-status.</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>bool</code></td><td class="fieldArgDesc">Whether <tt class="rst-docutils literal">patient_diagnose</tt> and <tt class="rst-docutils literal">filter_pattern</tt> match or not.</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.extract_filter_pattern">
    
  </a>
  <a name="extract_filter_pattern">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">extract_filter_pattern</span>(kwargs):
    
    <a class="headerLink" href="#extract_filter_pattern" title="lyprox.dataexplorer.query.extract_filter_pattern">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Sort the <tt class="rst-docutils literal">kwargs</tt> from the request.</p>
<p>The filter patterns are sent in the request (e.g. as <tt class="rst-docutils literal">{ipsi_IIa: True}</tt>). This
method sorts them into a dictionary by side (<tt class="rst-docutils literal">ipsi</tt> or <tt class="rst-docutils literal">contra</tt>) and by LNL.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">kwargs:</span><code>Dict[<wbr></wbr>str, <wbr></wbr>Optional[<wbr></wbr>bool]]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>Dict[<wbr></wbr>str, <wbr></wbr>Dict[<wbr></wbr>str, <wbr></wbr>Optional[<wbr></wbr>bool]]]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.patient_specific">
    
  </a>
  <a name="patient_specific">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">patient_specific</span>(patients=None, nicotine_abuse=None, hpv_status=None, neck_dissection=None, dataset__in=None, **rest):
    
    <a class="headerLink" href="#patient_specific" title="lyprox.dataexplorer.query.patient_specific">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Filter <tt class="rst-docutils literal">QuerySet</tt> of patients based on patient-specific properties.</p>
<p>This function is designed in such a way that one can simply add another
argument to its definition without actually changing the logic inside it
and it will the be able to filter for that added argument (given that it
is also a field in the model <code><a href="lyprox.patients.models.Patient.html" class="internal-link" title="lyprox.patients.models.Patient">patients.models.Patient</a></code>).</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">patients:</span><code>Optional[<wbr></wbr>QuerySet]</code></td><td class="fieldArgDesc">The <tt class="rst-docutils literal">QuerySet</tt> of patients to begin with. I <tt class="rst-docutils literal">None</tt>, this is just
the entire patient dataset.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">nicotine<wbr></wbr>_abuse:</span><code>Optional[<wbr></wbr>bool]</code></td><td class="fieldArgDesc">Filter smokers or non-smokers?</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">hpv<wbr></wbr>_status:</span><code>Optional[<wbr></wbr>bool]</code></td><td class="fieldArgDesc">Select based on HPV status.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">neck<wbr></wbr>_dissection:</span><code>Optional[<wbr></wbr>bool]</code></td><td class="fieldArgDesc">Filter thos that did or didn't undergo neck dissection.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">dataset<wbr></wbr>_<wbr></wbr>_in:</span><code>Optional[<wbr></wbr><a href="lyprox.accounts.models.Institution.html" class="internal-link" title="lyprox.accounts.models.Institution">Institution</a>]</code></td><td class="fieldArgDesc">Select based on the dataset that describes the respective patient.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">**rest</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>QuerySet</code></td><td class="fieldArgDesc">The filtered <tt class="rst-docutils literal">QuerySet</tt>.</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.run_query">
    
  </a>
  <a name="run_query">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">run_query</span>(patients, cleaned_form_data, do_compute_statistics=True):
    
    <a class="headerLink" href="#run_query" title="lyprox.dataexplorer.query.run_query">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Run a database query using the cleaned form data from the
<code><a href="lyprox.dataexplorer.forms.DashboardForm.html" class="internal-link" title="lyprox.dataexplorer.forms.DashboardForm">forms.DashboardForm</a></code>.</p>
<p>It first filters all patients in the database by patient-specific
characteristics. Then all tumors by tumor features. Afterwards, it only
keeps those patients that have tumors which were not yet filtered out.
It continues to remove patients based on their diagnosed lymph node
involvement and the selected involvement patterns.</p>
<p>The filtering parameters are provided by the cleaned data of a <code>form.DashboardForm</code>.
The default initial QuerySet of patients is simply all patients in the database,
unless <tt class="rst-docutils literal">patients</tt> is specified. In that case, the provided <tt class="rst-docutils literal">QuerySet</tt> is the
starting point of the filtering query.</p>
<p>The computation of statistics can be skipped using the <tt class="rst-docutils literal">do_compute_statistics</tt>
parameter (default is <tt class="rst-docutils literal">True</tt>).</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">patients:</span><code>Optional[<wbr></wbr>QuerySet]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">cleaned<wbr></wbr>_form<wbr></wbr>_data:</span><code>Dict[<wbr></wbr>str, <wbr></wbr>Any]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">do<wbr></wbr>_compute<wbr></wbr>_statistics:</span><code>bool</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>Dict[<wbr></wbr>int, <wbr></wbr>Any]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.sort_diagnoses_by_patient">
    
  </a>
  <a name="sort_diagnoses_by_patient">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">sort_diagnoses_by_patient</span>(diagnoses):
    
    <a class="headerLink" href="#sort_diagnoses_by_patient" title="lyprox.dataexplorer.query.sort_diagnoses_by_patient">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Use a <tt class="rst-docutils literal">QuerySet</tt> of <code>patient.models.Diagnose</code> and sort its entries into a
nested dictionary.</p>
<p>The top level of the dictionary has the patient's IDs as keys. Underneath it is
sorted by side (<tt class="rst-docutils literal">ipsi</tt> &amp; <tt class="rst-docutils literal">contra</tt>). The values of those are then <code>numpy</code>
matrices that are indexed by modality and by LNL. They hold the involvement that
was oserved by the corresponding modality for the respective LNL.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">diagnoses:</span><code>QuerySet</code></td><td class="fieldArgDesc">The <tt class="rst-docutils literal">QuerySet</tt> of diagnoses.</td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>Dict[<wbr></wbr>int, <wbr></wbr>Dict[<wbr></wbr>str, <wbr></wbr>np.ndarray]]</code></td><td class="fieldArgDesc">The sorted, nested dictionary.</td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.sort_patients_by_id">
    
  </a>
  <a name="sort_patients_by_id">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">sort_patients_by_id</span>(patients):
    
    <a class="headerLink" href="#sort_patients_by_id" title="lyprox.dataexplorer.query.sort_patients_by_id">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Collect patient information by patient ID in a dictionary.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">patients:</span><code>QuerySet</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>Dict[<wbr></wbr>int, <wbr></wbr>Any]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.sort_tumors_by_patient">
    
  </a>
  <a name="sort_tumors_by_patient">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">sort_tumors_by_patient</span>(tumors):
    
    <a class="headerLink" href="#sort_tumors_by_patient" title="lyprox.dataexplorer.query.sort_tumors_by_patient">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Collect tumor information by patient ID in a dictionary.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">tumors:</span><code>QuerySet</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>Dict[<wbr></wbr>int, <wbr></wbr>Any]</code></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr></table></div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.subsite2arr">
    
  </a>
  <a name="subsite2arr">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">subsite2arr</span>(subsite):
    
    <a class="headerLink" href="#subsite2arr" title="lyprox.dataexplorer.query.subsite2arr">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Map different subsites to an one-hot-array of subsite groups.</p>
<p>E.g., a one in the first place means "base of tongue", at the second place is
"tonsil" and so on.</p>
</div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.tf2arr">
    
  </a>
  <a name="tf2arr">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">tf2arr</span>(value):
    
    <a class="headerLink" href="#tf2arr" title="lyprox.dataexplorer.query.tf2arr">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Map <tt class="rst-docutils literal">True</tt>, <tt class="rst-docutils literal">False</tt> &amp; <tt class="rst-docutils literal">None</tt> to one-hot-arrays of length 3.</p>
<p>This particular mapping comes from the fact that in the form <tt class="rst-docutils literal">True</tt>, <tt class="rst-docutils literal">None</tt>,
<tt class="rst-docutils literal">False</tt> are represented by integers 1, 0, -1. So, the one-hot encoding uses an
array of length 3 that is one only at these respective indices, where -1 is the
last item.</p>
<p>See also the documentation of the <code><a href="#compute_statistics" class="internal-link" title="lyprox.dataexplorer.query.compute_statistics">compute_statistics</a></code> function for an explanation
of this encoding.</p>
</div>
  </div>
</div><div class="basefunction">
  
  
  <a name="lyprox.dataexplorer.query.tumor_specific">
    
  </a>
  <a name="tumor_specific">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">tumor_specific</span>(tumors=None, subsite__in=None, t_stage__in=None, central=None, extension=None, **rest):
    
    <a class="headerLink" href="#tumor_specific" title="lyprox.dataexplorer.query.tumor_specific">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p>Filter <tt class="rst-docutils literal">QuerySet</tt> of tumors based on tumor-specific properties.</p>
<p>It works almost exactly like the patient-specific querying function
<code><a href="#patient_specific" class="internal-link" title="lyprox.dataexplorer.query.patient_specific">patient_specific</a></code> in terms of adding new arguments to filter by.</p>
<table class="fieldTable"><tr class="fieldStart"><td class="fieldName" colspan="2">Parameters</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">tumors:</span><code>Optional[<wbr></wbr>QuerySet]</code></td><td class="fieldArgDesc"><tt class="rst-docutils literal">QuerySet</tt> of tumors to begin with. if <tt class="rst-docutils literal">None</tt>, this simply
includes all patients in the database.</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">subsite<wbr></wbr>_<wbr></wbr>_in:</span><code>Optional[<wbr></wbr>List[<wbr></wbr>str]]</code></td><td class="fieldArgDesc">Is the tumor's subsite in this list of subsites?</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">t<wbr></wbr>_stage<wbr></wbr>_<wbr></wbr>_in:</span><code>Optional[<wbr></wbr>List[<wbr></wbr>int]]</code></td><td class="fieldArgDesc">Does the tumor's T-stage match one of this list?</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">central:</span><code>Optional[<wbr></wbr>bool]</code></td><td class="fieldArgDesc">Is the tumor symmetric w.r.t. the mid-sagittal line?</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">extension:</span><code>Optional[<wbr></wbr>bool]</code></td><td class="fieldArgDesc">Does the tumor extend over the mid-sagittal line?</td></tr><tr><td class="fieldArgContainer"><span class="fieldArg">**rest</span></td><td class="fieldArgDesc"><span class="undocumented">Undocumented</span></td></tr><tr class="fieldStart"><td class="fieldName" colspan="2">Returns</td></tr><tr><td class="fieldArgContainer"><code>QuerySet</code></td><td class="fieldArgDesc">The <tt class="rst-docutils literal">QuerySet</tt> of tumors filtered for the requested characterisics.</td></tr></table></div>
  </div>
</div><div class="basevariable">
  
  
  <a name="lyprox.dataexplorer.query.logger">
    
  </a>
  <a name="logger">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-defname">logger</span> =
    
    <a class="headerLink" href="#logger" title="lyprox.dataexplorer.query.logger">
      
      
      ¶
    </a>
  </div>
  <div class="functionBody">
    
    <div><p class="undocumented">Undocumented</p></div>
    
  </div>
</div>
        </div>
      
      </div>
    </div>

    <footer class="navbar navbar-default">

  
  <div class="container">
    <a href="index.html">API Documentation</a> for LyProX,
  generated by <a href="https://github.com/twisted/pydoctor/">pydoctor</a>
    22.9.1 at 2023-10-20 06:34:19.
  </div>

  <!-- Search related scripts needs to be loaded at the end of HTML 
    parsing not to introduce overhead and display HTML data asap -->
  <script src="ajax.js" type="text/javascript"></script>
  <script src="searchlib.js" type="text/javascript"></script>
  <script src="search.js" type="text/javascript"></script>

</footer>
  
    <script src="pydoctor.js" type="text/javascript"></script>

  </body>
</html>